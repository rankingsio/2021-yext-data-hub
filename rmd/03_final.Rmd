---
title: "Yext DataHub"
author: |
  | Lead: Chris Dreyer ([rankings.io](https://rankings.io/))
  | Support: François Delavy & Daniel Kupka ([frontpagedata.com](https://frontpagedata.com/))
date: "Last updated on `r Sys.Date()`"
output:
  html_document:
    theme: paper
    highlight: kate
    # code_folding: hide
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    keep_md: true # keep the intermediary files, including the plots as .png
editor_options:
  chunk_output_type: console
---


<style>
.list-group-item.active, .list-group-item.active:hover, .list-group-item.active:focus {
background-color: #D21D5C;
border-color: #D21D5C;
}

body {
font-family: 'Alegreya Sans', sans-serif;
color: #333333;
font-size: 18px;
}

h1 {
font-weight: bold;
font-size: 28px;
}

h1.title {
font-size: 30px;
color: #111111;
}

h2 {
font-size: 24px;
}

h3 {
font-size: 18px;
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.showtext = TRUE,
                      dev = "svg")
knitr::knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark = ",", small.mark = ",", scientific = F)
})

required_packages <- c("tidyverse", "here", "patchwork") #, "colorspace", "pdftools", "kableExtra", "ggrepel", "ggiraph", "lubridate", "htmlwidgets")

for(i in required_packages) { 
  if(!require(i, character.only = T)) {
    
    #  if package is not existing, install then load the package
    install.packages(i, dependencies = T)
    require(i, character.only = T)
  }
}


# Theme: 

base_size = 10
r_col <- "#D21D5C" ## highlight color of rankings.io

my_theme <- function(){
  theme_minimal() +
    theme(
      plot.margin = margin(30, 30, 30, 30),
      plot.background = element_rect(color = "white",
                                     fill = "white"),
      plot.title = element_text(size = 1.4 * base_size),
      plot.title.position = "plot",
      plot.subtitle = element_text(size = base_size),
      plot.caption = element_text(color = "grey40",
                                  size = 0.9 * base_size),
      plot.caption.position = "plot",
      strip.text = element_text(size =  base_size,
                                face = "bold"),
      axis.line.x = element_line(color = "black",
                                 size = .8),
      axis.line.y = element_line(color = "black",
                                 size = .8),
      axis.title.x = element_text(size =  base_size,
                                  face = "bold"),
      axis.title.y = element_text(size = base_size,
                                  face = "bold"),
      axis.text = element_text(size = 0.9 * base_size,
                               color = "black",
                               face = "bold"),
      # axis.ticks = element_blank(),
      axis.ticks = element_line(color = "black"),
      panel.grid.major.x = element_line(size = .4,
                                        color = "#eaeaea",
                                        linetype = "solid"),
      panel.grid.major.y = element_line(size = .4,
                                        color = "#eaeaea",
                                        linetype = "solid"),
      panel.grid.minor.x = element_line(size = .4,
                                        color = "#eaeaea",
                                        linetype = "solid"),
      panel.grid.minor.y = element_blank(),
      panel.spacing.x = unit(2, "lines"),
      panel.spacing.y = unit(1, "lines")
    )
}


## numeric format for labels
num_format <- scales::format_format(big.mark = ",", small.mark = ",", scientific = F)

```


```{r data, include=FALSE}

# LOAD DATA sent by Yext:
yext_data <- rio::import(here::here("proc_data", "yext_data.rds"))


# we append new values to the Yext Data
# these are the values of the last 2 months absent from the data sent by Yext.
# these were collected manually online.
new_Longtail_Imps_and_Clicks <- tibble(
  `Month of Date1` = c("September", "October"),
  `Year of Date1` = c(2021, 2021),
  `Avg. Longtail Clicks Per Loc` = c(5.99, 6.09),
  `Avg. Longtail Impressions Per Loc` = c(123.9, 127.7),
  char_date = c("September 2021", "October 2021"),
  date = lubridate::as_date(c("2021-09-01", "2021-10-01"), format = "%Y-%m-%d")
)
yext_data$Longtail_Imps_and_Clicks <- yext_data$Longtail_Imps_and_Clicks %>% 
  rbind(new_Longtail_Imps_and_Clicks)

# Google Maps Views, Google search views
new_Google_Maps_and_Search_Views <- tibble(
  `Month of Date1` = c("September", "October"),
  `Year of Date1` = c(2021, 2021),
  `Avg. Google Maps Views Per Loc` = c(1751, 1631),
  `Avg. Google Search Views Per Loc` = c(1733.7, 1496.7),
  char_date = c("September 2021", "October 2021"),
  date = lubridate::as_date(c("2021-09-01", "2021-10-01"), format = "%Y-%m-%d")
)
yext_data$G_MVs <- yext_data$G_MVs %>%
  rbind(new_Google_Maps_and_Search_Views)

# Google Driving Directions, phone calls, website clicks


# load data collected online for key comparisons:
# these are the data about all industries:

extend_network_listings_all_industries <- rio::import(here::here(
  "proc_data",
  "Search_Network_Listings-all_verticals-USA-(2021-11-14).csv")
) %>%
  mutate(date = lubridate::as_date(date, format = "%d.%m.%Y"))

google_maps_and_search_views_all_industries <- rio::import(here::here(
  "proc_data",
  "Google Listings Impressions (2011-11-17).csv")
) %>%
  mutate(date = lubridate::as_date(date, format = "%d.%m.%Y"))


```



# Introduction 

Yext, a company providing _entreprise search_ solutions based on Natural Language Processing and AI, publish anonymized data on their [Search Data Hub](https://www.yext.com/search-data-hub). These data are samples of listing and local page data across a variety of search engines, and other digital endpoints collected by Yext from their clients. They allow for exploring insights on consumer behavior trends — including shifts in search volume and foot traffic trends by industry. 

We have analyzed these data for the industry of the Legal Services. What can we learn from Yext Search Data Hub that is relevant for personal injury lawyers? We present here our key findings.  


# Methodology
Yext kindly provided us with a subset of the data from the Search Data Hub: data about _Legal Services_ (subvertical) coming from U.S. companies. We enriched these data with key spot comparisons observed directly on the online [Search Data Hub](https://www.yext.com/search-data-hub).  

## About the Data

Yext mentions that:  
"The data is comprised  comprised of a sample of listing and local page data across a variety of search engines, and other digital endpoints. Insights are shown only on a region and industry level where there are sufficient businesses, locations, and search engine data sources to maintain anonymity and privacy for Yext customers and where Yext customers have adopted the platform for a sufficient period of time to provide a meaningful comparison year over year. As data may vary between regions due to, among other things, the sample size or availability of data for certain businesses and subverticals, industry insights may not be comparable across regions."  

Sample Size for the "subvertical" of _Legal Services_ in the U.S.: 5409 businesses including 7249 entities.   
Sample Size for the whole the U.S., all the industries (all subverticals): 5409 businesses including 7249 entities.   


[add number of companies for the legal services here .] LISTING SAMPLE SiZE  

* mANUAALLY ADD THE DATA FROM LAST MONTH(S)

## Interpretation
The data published by Yext, and presented in this analysis, are better compared over time. Trends are more interesting and insightful than absolute values.

## Glossary

* Impressions:
* Clicks
* Views

2) Are “listing”, "website URL” and “entity” three words that represent the same thing?  
_Not quite. An entity would be an actual location, a physician, an ATM. Any real-world object in this case. A listing is what you see in a local pack or a map pack on a search engine. The screenshot below shows three Google listings for Dominos entities (locations in this case). When managed properly each of these location entities has several listings on other search engines like Bing, Yahoo, etc. A website URL would depend on the context but for the sake of this data generally refers to the local page associated with a location. Let me know where you see that phrase and I can elaborate. Screenshots attached to illustrate these last two._

# Research Findings 


## Extended Network Impressions and Clicks

The _impressions_ represent the number of times a sample of listings appeared in search results across Google Maps, Google Search, Bing, Facebook, and the broader network. And the _clicks_, the clicks...

```{r fig.width=8, fig.height=4}

Impressions <- yext_data$Longtail_Imps_and_Clicks %>% 
  ggplot(aes(x = date, y = `Avg. Longtail Impressions Per Loc`)) +
  geom_line() + 
  labs(title = "Average Extended Network Impressions",
       subtitle = "For Longtail Keywords",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  my_theme()

Clicks <- yext_data$Longtail_Imps_and_Clicks %>% 
  ggplot(aes(x = date, y = `Avg. Longtail Clicks Per Loc` )) +
  geom_line() + 
  labs(title = "Average Extended Network Clicks",
       subtitle = "For Longtail Keywords",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  my_theme()


Impressions + Clicks

# yext_data$Longtail_Imps_and_Clicks %>% 
#   select(date, `Avg. Longtail Impressions Per Loc`, `Avg. Longtail Clicks Per Loc` ) %>%
#   pivot_longer(cols = c(`Avg. Longtail Impressions Per Loc`, `Avg. Longtail Clicks Per Loc`), 
#                names_to = "measure", values_to = "values")


# Some Statistics:

ctr <- 
rcor <- cor(yext_data$Longtail_Imps_and_Clicks$`Avg. Longtail Impressions Per Loc`, yext_data$Longtail_Imps_and_Clicks$`Avg. Longtail Clicks Per Loc`)

```

There is a sudden increase in the _Average Extended Network Clicks_ since summer 2021.  

Visually, there does not seem to be a large correlation between the _impressions_ and the _clicks_, except for the recent increase. However, the Pearson correlation coefficient is $r = `r round(rcor, 2)`$. This coefficient oscillate between 0, there is no linear correlation, the clicks have no relations to impressions, and 1, there is a perfect correlation between impressions and clicks. There is some correlation between the number of impressions and the clicks, meaning that the number of clicks is not completely independent from the number of impressions. However, this relation is not perfect and an increase in the number of impressions is not necessarily, directly and completely reflected in the number of clicks.  

### Click-Through Rate

As Yext is sharing both impressions and clicks, we can compute the average _Click-Through Rate_ (CTR): $CTR = clicks / impressions$. 

```{r  fig.height=4}
yext_data$Longtail_Imps_and_Clicks %>% 
  ggplot(aes(x = date, y = `Avg. Longtail Clicks Per Loc`/`Avg. Longtail Impressions Per Loc` )) +
  geom_line() + 
  labs(title = "Average Extended Network CTR",
       subtitle = "For Longtail Keywords",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  scale_y_continuous(labels = scales::label_percent()) +
  my_theme()

CTR_legalservices = yext_data$Longtail_Imps_and_Clicks %>% 
  mutate(ctr = `Avg. Longtail Clicks Per Loc`/`Avg. Longtail Impressions Per Loc`) %>%
  summarise(mean_ctr = mean(ctr))
```

The average CTR inn _legal services_ for longtail keywords in the extended network (Google Maps, Google Search, Bing, Facebook, and the broader network) is of `r round(CTR_legalservices*100, 2)`%.  

### Industry Comparison

We compare the Extended Network Impressions and Clicks from the _legal services_ to the same metrics for _all the industries_. By doing so, we compare the performance of listings in the _legal services_ to the global average.  

```{r fig.width=8}

Longtail_Imps_and_Clicks_all_data <- yext_data$Longtail_Imps_and_Clicks %>%
  select(date, impressions = `Avg. Longtail Impressions Per Loc`, clicks = `Avg. Longtail Clicks Per Loc`) %>%
  mutate(source = "legal_services") %>%
  rbind(extend_network_listings_all_industries) %>%
  pivot_longer(cols = c(impressions, clicks), names_to = "metric", values_to = "value")

Impressions <- Longtail_Imps_and_Clicks_all_data %>% 
  filter(metric == "impressions") %>%
  ggplot(aes(x = date, y = value, color = source)) +
  geom_line() + 
  labs(title = "Average Extended Network Impressions",
       subtitle = "For Longtail Keywords",
       caption = "Geography: U.S.") +
  scale_color_manual(values = c(r_col, "black")) +
  xlab("") +
  ylab("") +
  my_theme() +
  annotate("text", x = lubridate::as_date("2019-10-01"), y = 100, label = "Legal Services") +
  annotate("text", x = lubridate::as_date("2020-01-01"), y = 230, label = "All Industries", color = r_col) +
  theme(legend.position = "none")


Clicks <- Longtail_Imps_and_Clicks_all_data %>% 
  filter(metric == "clicks") %>%
  ggplot(aes(x = date, y = value, color = source)) +
  geom_line() + 
  labs(title = "Average Extended Network Clicks",
       subtitle = "For Longtail Keywords",
       caption = "Geography: U.S.") +
  scale_color_manual(values = c(r_col, "black")) +
  xlab("") +
  ylab("") +
  my_theme()  +
  annotate("text", x = lubridate::as_date("2019-08-01"), y = 3, label = "Legal Services") +
  annotate("text", x = lubridate::as_date("2020-01-01"), y = 22, label = "All Industries", color = r_col) +
  theme(legend.position = "none")


Impressions + Clicks

# correlation btw Impressions and Clicks for All_Industry
rcor_allindustry <- cor(
  Longtail_Imps_and_Clicks_all_data %>% filter(source == "all_verticals", metric == "impressions") %>% .$value, 
  Longtail_Imps_and_Clicks_all_data %>% filter(source == "all_verticals", metric == "clicks") %>% .$value)

# some basic stats:
avg_impressions_allindustry = Longtail_Imps_and_Clicks_all_data %>% 
  filter(source == "all_verticals", metric == "impressions") %>%
  .$value %>%
  mean()
avg_clicks_allindustry = Longtail_Imps_and_Clicks_all_data %>% 
  filter(source == "all_verticals", metric == "clicks") %>%
  .$value %>%
  mean()
avg_impressions_legalservices = Longtail_Imps_and_Clicks_all_data %>% 
  filter(source == "legal_services", metric == "impressions") %>%
  .$value %>%
  mean()
avg_clicks_legalservices = Longtail_Imps_and_Clicks_all_data %>% 
  filter(source == "legal_services", metric == "clicks") %>%
  .$value %>%
  mean()
CTR_allindustry = Longtail_Imps_and_Clicks_all_data %>% 
  filter(source == "all_verticals") %>%
  pivot_wider(names_from = metric) %>%
  mutate(ctr = clicks / impressions) %>%
  summarise(mean_ctr = mean(ctr))

```

The _Average Extended Network Impressions for Longtail Keywords_ for _all industries together_ is `r round(avg_impressions_allindustry/avg_impressions_legalservices, 1)` times larger than for _legal services_. The gap is even larger for the _Clicks_: it is `r round(avg_clicks_allindustry/avg_clicks_legalservices, 1)` times larger for _all industries together_ than for _legal services_. This suggests that, in this sample, _legal services_ have generally less success in turning impressions into clicks. This is reflected in the CTR, which is on average `r round(CTR_allindustry*100, 2)`%, much higher than the average CTR shown above for the _legal services_: `r round(CTR_legalservices*100, 2)`%.  

When measured on the whole industry, there is a much larger correlation between the impressions and the clicks: the Pearson correlation coefficient is $r = `r round(rcor_allindustry, 2)`$.  

```{r}

# EVENTUALLY ADD HERE CORRELATION BTW INDUSTRY AND LEGAL SERVICES.

```


## Google My Business

This chapter focuses on the Google ecosystem.  

### Impressions

The _Average Google Maps Views Per Location_ represents number of times the listing was viewed on a Google Map. The _Average Google Search Views Per Location_ represents the number of times the listing was viewed on Google Search. Google Map Views and Google Search Views together represent the total number of impressions listings receive across the Google ecosystem.

```{r, fig.align='center', fig.width=10, fig.height=4}

maps <- yext_data$G_MVs %>% 
  ggplot(aes(x = date, y = `Avg. Google Maps Views Per Loc` )) +
  geom_line() +
  labs(title = "Average Google Maps Views Per Location",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  my_theme()

searches <- yext_data$G_MVs %>% 
  ggplot(aes(x = date, y = `Avg. Google Search Views Per Loc` )) +
  geom_line() + 
  labs(title = "Average Google Search Views Per Location",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  my_theme()

maps + searches

```


The _Average Google Maps Views Per Location_ decreased by 73.6% between February and April 2020, at the beginning of the COVID pandemic, and is slowly recovering.   

The _Average Google Search Views Per Location_ is growing steadily since mid-2020. It has never been so high.  

#### Industry Comparison

We compare the Google Maps and Search Views from the _legal services_ to the same metrics for _all the industries_. By doing so, we compare the performance of listings in the _legal services_ to the global average.   

```{r fig.width=8}

google_maps_and_search_views_all_data <- yext_data$G_MVs %>%
  select(date, map_views = `Avg. Google Maps Views Per Loc`, search_views = `Avg. Google Search Views Per Loc`) %>%
  mutate(source = "legal_services") %>%
  rbind(google_maps_and_search_views_all_industries) %>%
  pivot_longer(cols = c(map_views, search_views), names_to = "metric", values_to = "value")

Map_Views <- google_maps_and_search_views_all_data %>% 
  filter(metric == "map_views") %>%
  ggplot(aes(x = date, y = value, color = source)) +
  geom_line() + 
  labs(title = "Average Google Maps Views Per Location",
       # subtitle = "For Longtail Keywords",
       caption = "Geography: U.S.") +
  scale_color_manual(values = c(r_col, "black")) +
  xlab("") +
  ylab("") +
  my_theme() +
  annotate("text", x = lubridate::as_date("2019-10-01"), y = 4000, label = "Legal Services") +
  annotate("text", x = lubridate::as_date("2020-08-20"), y = 18000, label = "All Industries", color = r_col) +
  theme(legend.position = "none")

Search_Views <- google_maps_and_search_views_all_data %>% 
  filter(metric == "search_views") %>%
  ggplot(aes(x = date, y = value, color = source)) +
  geom_line() + 
  labs(title = "Average Google Search Views Per Location",
       # subtitle = "For Longtail Keywords",
       caption = "Geography: U.S.") +
  scale_color_manual(values = c(r_col, "black")) +
  xlab("") +
  ylab("") +
  my_theme() +
  annotate("text", x = lubridate::as_date("2019-10-01"), y = 2000, label = "Legal Services") +
  annotate("text", x = lubridate::as_date("2019-09-01"), y = 7400, label = "All Industries", color = r_col) +
  theme(legend.position = "none")

Map_Views + Search_Views


```


### Clicks

The _Average Google Phone Calls Per Location_ represents the number of times a user clicked on the phone call link from a Google listing. There was a clear dip of around -30% at the onset of the COVID pandemic. This metric has reached the maximum level again since.    

```{r fig.height=4}

yext_data$G_PCs %>%
  ggplot(aes(x = date, y = `Avg. Google Phone Calls Per Loc` )) +
  geom_line() +
  labs(title = "Average Google Phone Calls Per Location",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  my_theme()

```

The _Average Google Website Clicks Per Location_ represents the number of times a consumer clicked through to the corporate domain from a location page. It seems that there was a small dip at the onset of the COVID pandemic, but it is less clear.     

```{r}
yext_data$G_PCs %>%
  ggplot(aes(x = date, y = `Avg. Google Website Clicks Per Loc` )) +
  geom_line() +
  labs(title = "Average Google Website Clicks Per Location",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  my_theme()
```

The _Average Google Driving Directions Per Location_ represents the number of times a consumer clicked to get driving directions from the location pages. This metric was clearly affected by the COVID pandemic. It dropped by 80% between February and april 2020. It is slowly recovering, now reaching about 80% of the pre-pandemic level.      

```{r}
yext_data$G_DDs %>%
  ggplot(aes(x = date, y = `Avg. Google Driving Directions Per Loc` )) +
  geom_line() +
  labs(title = "Average Google Driving Directions Per Location",
       caption = "Industry: Legal Services, Geography: U.S.") +
  xlab("") +
  ylab("") +
  my_theme()
```

### Industry Comparison



# Summary and Main Findings

* COVID -> return to normal for maps, + more and more searches ==> invest in online presence
* Smaller impressions, clicks, and CTR in legal services as compared to average of the whole industry. ==> Room for growth.


